@page "/challenges"

<Container Condition="Challenges?.Any() == true">
    <ChildContent>
        <div class="container">
            <Container Condition="!string.IsNullOrWhiteSpace(Error)">
                <div class="notification is-danger m-3">
                    @Error
                </div>
            </Container>

            <div class="field m-3 is-grouped">
                <p class="control is-expanded">
                    <input class="input" type="text" placeholder="Id GeoGuessr" @bind="GeoGuessrId">
                </p>
                <div class="control">
                    <button type="submit" class="button is-primary" @onclick="Import">Importer</button>
                </div>
            </div>
            <article class="message m-3">
                <div class="message-body">
                    Seule l'id GeoGuessr est recevable, par exemple pour <em>https://www.geoguessr.com/challenge/uGnmazjHKBZs78JR</em>, rentrer <strong>uGnmazjHKBZs78JR</strong>.
                </div>
            </article>

            <Table @ref="ChallengesTable"
                   Items="Challenges"
                   Headers="@(new TableHeader[]
                                  {
                                      new("Nom", false, string.Empty),
                                      new("Id GeoGuessr", false, string.Empty),
                                      new("Meilleur score", true, nameof(PlayerScoreDto.Sum)),
                                      new("", false, string.Empty),
                                  })"
                   Paginate="true"
                   PageSize="20"
                   IsNarrow="false"
                   SortFunction="Sort">
                <RowContent Context="challenge">
                    <td>@challenge.MapName</td>
                    <td>@challenge.GeoGuessrId</td>
                    <td>@challenge.PlayerScores.Max(p => p.Sum)</td>
                    <td>
                        <a href="@NavigationManager.ToAbsoluteUri($"/challenges/{challenge.Id}")">
                            <span class="icon is-small">
                                <i class="fas fa-external-link-alt"></i>
                            </span>
                        </a>
                        <a href="https://www.geoguessr.com/challenge/@challenge.GeoGuessrId" target="_blank">
                            <span class="icon is-small">
                                <i class="fas fa-link"></i>
                            </span>
                        </a>
                    </td>
                </RowContent>
            </Table>
        </div>
    </ChildContent>

    <ElseContent>
        <LoadingAnimation Animated="true">
            Chargement des challenges...
        </LoadingAnimation>
    </ElseContent>
</Container>
